<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VNE File Decoder</title>
    <meta name="description" content="Learn to create interactive video novels with the Video Novel Engine (VNE). Follow our step-by-step tutorial and preview an example project to see how it works.">
    <meta name="keywords" content="Video Novel Engine, VNE, interactive video, video novel tutorial, create video novel, interactive storytelling, multimedia storytelling">
    <meta name="author" content="ArtoriasphereOrg">
    <meta name="robots" content="index, follow">

    <!-- Open Graph Meta Tags (for social media sharing) -->
    <meta property="og:title" content="Video Novel Engine (VNE) Tutorial & Preview">
    <meta property="og:description" content="Discover how to build interactive video novels using the Video Novel Engine. Explore our tutorial and see a live preview of an example project.">
    <meta property="og:image" content="https://raw.githubusercontent.com/ArtoriasphereOrg/VNE---Video-novel-engine/refs/heads/main/Untitled%20design.png">
    <meta property="og:url" content="https://artoriasphereorg.github.io/VNE---Video-novel-engine/Tutorial/index.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Video Novel Engine by ArtoriasphereOrg">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Video Novel Engine (VNE) Tutorial & Preview">
    <meta name="twitter:description" content="Learn to create interactive video novels with VNE. Check out our tutorial and preview an example project.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/ArtoriasphereOrg/VNE---Video-novel-engine/refs/heads/main/Untitled%20design.png">
    <meta name="twitter:site" content="@ArtoriasphereOrg">

    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/ArtoriasphereOrg/VNE---Video-novel-engine/refs/heads/main/Untitled%20design.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/ArtoriasphereOrg/VNE---Video-novel-engine/refs/heads/main/Untitled%20design.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://artoriasphereorg.github.io/VNE---Video-novel-engine/Tutorial/index.html">

    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="application-name" content="Video Novel Engine">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
            color: #333;
        }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            color: #1a202c;
            margin-bottom: 1.5rem;
        }
        #fileUploadContainer {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin: 2rem 0;
            border: 2px dashed #e2e8f0;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        #fileUploadContainer.dragover {
            border-color: #007bff;
            background: #f0f9ff;
        }
        #fileInput {
            display: none;
        }
        #fileInputLabel {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: transform 0.2s ease-in-out, background-color 0.3s ease;
        }
        #fileInputLabel:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        #fileInputLabel.dragover {
            transform: scale(1.1);
        }
        #fileName {
            margin-top: 1rem;
            font-size: 1rem;
            color: #4a5568;
            word-break: break-all;
        }
        #decodeButton {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 1.5rem;
            transition: transform 0.2s ease-in-out, background-color 0.3s ease;
            animation: pulse 2s infinite ease-in-out;
        }
        #decodeButton:hover {
            background: #218838;
            transform: scale(1.05);
        }
        #decodeButton:disabled {
            background: #b0b0b0;
            cursor: not-allowed;
            animation: none;
        }
        #videoContainer {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: black;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        #muteButton, #fullscreenButton, #subtitleButton {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            font-size: 16px;
            z-index: 100;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        #muteButton:hover, #fullscreenButton:hover, #subtitleButton:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        #fullscreenButton {
            right: 70px;
        }
        #subtitleButton {
            right: 120px;
        }
        #playButtonContainer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #playScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: black;
            display: none;
            z-index: 50;
        }
        #playText {
            color: white;
            font-size: 1.5rem;
            font-family: 'Inter', sans-serif;
            text-align: center;
            margin-bottom: 1.5rem;
            animation: fadeInScale 1s ease-in-out forwards;
        }
        #playButton {
            padding: 15px 30px;
            font-size: 1.5rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.3s ease;
            animation: pulse 2s infinite ease-in-out;
        }
        #playButton:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5rem;
            z-index: 1000;
            display: none;
        }
        #loadingScreen::after {
            content: '';
            width: 24px;
            height: 24px;
            border: 4px solid #ffffff;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
        @keyframes choiceIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes choiceOut {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .choice-button {
            animation: choiceIn 0.3s ease-in-out forwards;
        }
        .choice-button-exit {
            animation: choiceOut 0.3s ease-in-out forwards;
        }
    </style>
</head>
<body>
    <h1>VNE</h1>
    <h1>Demo - Game loader</h1>
    <h1>By Artoriasphere this just demo system</h1>
    <div id="fileUploadContainer">
        <label for="fileInput" id="fileInputLabel">Drop .vne File</label>
        <input type="file" id="fileInput" accept=".vne">
        <div id="fileName"></div>
        <button id="decodeButton" onclick="decodeFile()" disabled>Decode File</button>
    </div>
    <div id="videoContainer"></div>
    <div id="playScreen"></div>
    <div id="playButtonContainer" style="display: none;">
        <div id="playText">Press button to play</div>
        <button id="playButton">Play</button>
    </div>
    <div id="loadingScreen">Loading...</div>

    <script>
        // Simple decode function for .vne file content
        function simpleDecode(str) {
            let result = '';
            for (let char of str) {
                let code = char.charCodeAt(0);
                if (code >= 32 && code <= 126) {
                    code = ((code - 32 - 5 + 95) % 95) + 32;
                }
                result += String.fromCharCode(code);
            }
            return result;
        }

        // Function to parse XML and extract video URL, frame times, subtitles, choices, and MP3 links
        function parseVNEContent(xmlString) {
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlString, 'text/xml');
                
                if (xmlDoc.querySelector('parsererror')) {
                    throw new Error('Invalid XML format');
                }

                const videoURL = xmlDoc.querySelector('VideoURL')?.textContent;
                const frames = Array.from(xmlDoc.querySelectorAll('Frame')).map(frame => {
                    const time = parseFloat(frame.getAttribute('time'));
                    const subtitle = frame.querySelector('Subtitle')?.textContent || '';
                    const mp3 = frame.querySelector('MP3')?.textContent || '';
                    const choices = Array.from(frame.querySelectorAll('Choice')).map(choice => ({
                        text: choice.querySelector('Text')?.textContent || '',
                        action: choice.querySelector('Action')?.textContent || '',
                        url: choice.querySelector('Url')?.textContent || '',
                        time: parseFloat(choice.querySelector('Time')?.textContent) || 0,
                        backgroundButtonColor: choice.querySelector('BackgroundButtonColor')?.textContent || '#007bff',
                        width: parseFloat(choice.querySelector('Width')?.textContent) || undefined,
                        height: parseFloat(choice.querySelector('Height')?.textContent) || undefined,
                        borderRadius: choice.querySelector('BorderRadius')?.textContent || undefined,
                        top: parseFloat(choice.querySelector('Top')?.textContent) || 0,
                        left: parseFloat(choice.querySelector('Left')?.textContent) || 0
                    }));
                    return { time, subtitle, mp3, choices };
                });
                return { videoURL, frames };
            } catch (error) {
                throw new Error('Error parsing XML: ' + error.message);
            }
        }

        // Function to save settings to localStorage
        function saveSettings(settings) {
            localStorage.setItem('videoSettings', JSON.stringify(settings));
        }

        // Function to load settings from localStorage
        function loadSettings() {
            const settings = localStorage.getItem('videoSettings');
            return settings ? JSON.parse(settings) : {
                isMuted: false,
                isFullscreen: false,
                showSubtitles: true
            };
        }

        // Function to handle video playback, frame times, subtitles, choices, and MP3 playback
        function setupVideoPlayer(videoURL, frames) {
            const videoContainer = document.getElementById('videoContainer');
            const playButtonContainer = document.getElementById('playButtonContainer');
            const playScreen = document.getElementById('playScreen');
            videoContainer.innerHTML = '';
            playButtonContainer.style.display = 'none';
            playScreen.style.display = 'none';

            const video = document.createElement('video');
            video.src = videoURL;
            video.autoplay = true;
            videoContainer.appendChild(video);

            // Create audio element for MP3 playback
            const audio = new Audio();
            audio.crossOrigin = 'anonymous';
            let currentMp3 = null;

            // Load settings from localStorage
            const settings = loadSettings();
            video.muted = settings.isMuted;
            audio.muted = settings.isMuted;
            let showSubtitles = settings.showSubtitles;

            if (settings.isFullscreen && !document.fullscreenElement) {
                videoContainer.requestFullscreen().catch(err => console.error('Fullscreen error:', err));
            }

            // Add mute button
            const muteButton = document.createElement('button');
            muteButton.id = 'muteButton';
            muteButton.innerHTML = video.muted 
                ? '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M20 12l-6-6m0 12l6-6"/></svg>'
                : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>';
            videoContainer.appendChild(muteButton);
            muteButton.onclick = () => {
                video.muted = !video.muted;
                audio.muted = video.muted;
                settings.isMuted = video.muted;
                saveSettings(settings);
                muteButton.innerHTML = video.muted 
                    ? '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M20 12l-6-6m0 12l6-6"/></svg>'
                    : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>';
            };

            // Add fullscreen button
            const fullscreenButton = document.createElement('button');
            fullscreenButton.id = 'fullscreenButton';
            fullscreenButton.innerHTML = document.fullscreenElement 
                ? '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>'
                : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>';
            videoContainer.appendChild(fullscreenButton);
            fullscreenButton.onclick = () => {
                if (!document.fullscreenElement) {
                    videoContainer.requestFullscreen().catch(err => console.error('Fullscreen error:', err));
                    settings.isFullscreen = true;
                    fullscreenButton.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg>';
                } else {
                    document.exitFullscreen();
                    settings.isFullscreen = false;
                    fullscreenButton.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>';
                }
                saveSettings(settings);
            };

            // Add subtitle toggle button
            const subtitleButton = document.createElement('button');
            subtitleButton.id = 'subtitleButton';
            subtitleButton.innerHTML = showSubtitles 
                ? '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" ry="2"/><path d="M6 8h12M6 12h6m2 0h4M6 16h4m2 0h6"/></svg>'
                : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" ry="2"/><path d="M6 8h12M6 12h6m2 0h4M6 16h4m2 0h6"/><path d="M2 2l20 20"/></svg>';
            videoContainer.appendChild(subtitleButton);
            subtitleButton.onclick = () => {
                showSubtitles = !showSubtitles;
                settings.showSubtitles = showSubtitles;
                saveSettings(settings);
                subtitleButton.innerHTML = showSubtitles 
                    ? '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" ry="2"/><path d="M6 8h12M6 12h6m2 0h4M6 16h4m2 0h6"/></svg>'
                    : '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2" ry="2"/><path d="M6 8h12M6 12h6m2 0h4M6 16h4m2 0h6"/><path d="M2 2l20 20"/></svg>';
                const subtitleElement = document.getElementById('subtitleDisplay');
                if (subtitleElement) {
                    subtitleElement.style.display = showSubtitles ? 'block' : 'none';
                }
            };

            // Show the video container
            videoContainer.style.display = 'flex';

            const loggedFrames = new Set();
            let choiceButtons = [];
            let subtitleTimeout = null;

            // Function to clear choice buttons
            function clearChoices() {
                choiceButtons.forEach(button => {
                    button.classList.remove('choice-button');
                    button.classList.add('choice-button-exit');
                    button.addEventListener('animationend', () => {
                        button.remove();
                    }, { once: true });
                });
                choiceButtons = [];
            }

            // Function to display subtitle with auto-hide after 5 seconds
            function displaySubtitle(subtitle) {
                if (!showSubtitles) return;
                let subtitleElement = document.getElementById('subtitleDisplay');
                if (!subtitleElement) {
                    subtitleElement = document.createElement('div');
                    subtitleElement.id = 'subtitleDisplay';
                    subtitleElement.style.position = 'absolute';
                    subtitleElement.style.bottom = '20px';
                    subtitleElement.style.left = '50%';
                    subtitleElement.style.transform = 'translateX(-50%)';
                    subtitleElement.style.color = 'white';
                    subtitleElement.style.background = 'rgba(0, 0, 0, 0.7)';
                    subtitleElement.style.padding = '10px';
                    subtitleElement.style.borderRadius = '5px';
                    subtitleElement.style.fontSize = '18px';
                    subtitleElement.style.textAlign = 'center';
                    videoContainer.appendChild(subtitleElement);
                }
                subtitleElement.textContent = subtitle;
                subtitleElement.style.opacity = '1';
                subtitleElement.style.display = 'block';
                
                // Clear any existing timeout
                if (subtitleTimeout) {
                    clearTimeout(subtitleTimeout);
                }
                
                // Set timeout to hide subtitle after 5 seconds
                subtitleTimeout = setTimeout(() => {
                    subtitleElement.style.animation = 'fadeOut 0.5s ease-out';
                    subtitleElement.addEventListener('animationend', () => {
                        subtitleElement.textContent = '';
                        subtitleElement.style.animation = '';
                        subtitleElement.style.opacity = '0';
                    }, { once: true });
                }, 5000);
            }

            // Function to play MP3
            function playMp3(mp3Url) {
                if (currentMp3 === mp3Url) return; // Prevent replaying the same MP3
                audio.pause();
                audio.src = mp3Url;
                audio.currentTime = 0;
                currentMp3 = mp3Url;
                audio.play().catch(err => {
                    console.error('Error playing MP3:', err);
                    alert('Failed to play MP3. Please ensure the server supports CORS.');
                });
            }

            // Function to stop MP3
            function stopMp3() {
                audio.pause();
                audio.src = '';
                currentMp3 = null;
            }

            // Function to display choices
            function displayChoices(choices, currentTime) {
                clearChoices();
                choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.textContent = choice.text;
                    button.classList.add('choice-button');
                    button.style.position = 'relative';
                    button.style.top = `${choice.top}px`;
                    button.style.left = `${choice.left}px`;
                    button.style.background = choice.backgroundButtonColor;
                    button.style.color = 'white';
                    button.style.border = 'none';
                    button.style.cursor = 'pointer';
                    button.style.fontSize = '16px';
                    button.style.transition = 'transform 0.2s ease-in-out, background-color 0.3s ease';
                    button.style.margin = '5px';
                    // Apply width, height, and borderRadius if provided
                    if (choice.width) {
                        button.style.width = `${choice.width}px`;
                        button.style.padding = '0'; // Override default padding
                    } else {
                        button.style.padding = '10px 20px'; // Default padding
                    }
                    if (choice.height) {
                        button.style.height = `${choice.height}px`;
                        button.style.lineHeight = 'normal'; // Prevent text misalignment
                    }
                    if (choice.borderRadius) {
                        button.style.borderRadius = choice.borderRadius;
                    } else {
                        button.style.borderRadius = '5px'; // Default border-radius
                    }
                    button.onmouseover = () => {
                        button.style.background = darkenColor(choice.backgroundButtonColor);
                        button.style.transform = 'scale(1.05)';
                    };
                    button.onmouseout = () => {
                        button.style.background = choice.backgroundButtonColor;
                        button.style.transform = 'scale(1)';
                    };
                    button.onclick = () => {
                        if (choice.action === 'link') {
                            window.open(choice.url, '_blank');
                        } else if (choice.action === 'continue') {
                            video.currentTime = choice.time;
                            video.play();
                            clearChoices();
                            stopMp3();
                        }
                    };
                    videoContainer.appendChild(button);
                    choiceButtons.push(button);
                });
            }

            // Function to darken color for hover effect
            function darkenColor(hex) {
                hex = hex.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);
                return `rgb(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)})`;
            }

            video.addEventListener('timeupdate', () => {
                const currentTime = video.currentTime;
                frames.forEach(frame => {
                    if (!loggedFrames.has(frame.time) && Math.abs(currentTime - frame.time) < 0.2) {
                        loggedFrames.add(frame.time);
                        if (frame.subtitle && showSubtitles) {
                            displaySubtitle(frame.subtitle);
                        } else {
                            const subtitleElement = document.getElementById('subtitleDisplay');
                            if (subtitleElement) {
                                subtitleElement.style.animation = 'fadeOut 0.5s ease-out';
                                subtitleElement.addEventListener('animationend', () => {
                                    subtitleElement.textContent = '';
                                    subtitleElement.style.animation = '';
                                    subtitleElement.style.opacity = '0';
                                }, { once: true });
                            }
                        }
                        if (frame.mp3) {
                            playMp3(frame.mp3);
                        } else {
                            stopMp3();
                        }
                        if (frame.choices && frame.choices.length > 0) {
                            video.pause();
                            displayChoices(frame.choices, frame.time);
                        } else {
                            clearChoices();
                        }
                    }
                });
            });

            video.addEventListener('play', () => {
                if (video.currentTime === 0) {
                    loggedFrames.clear();
                    clearChoices();
                    stopMp3();
                    const subtitleElement = document.getElementById('subtitleDisplay');
                    if (subtitleElement) {
                        subtitleElement.textContent = '';
                        subtitleElement.style.opacity = '0';
                        subtitleElement.style.display = showSubtitles ? 'block' : 'none';
                    }
                }
            });

            // Stop MP3 when video ends or is paused (unless paused due to choices)
            video.addEventListener('ended', stopMp3);
            video.addEventListener('pause', () => {
                const currentTime = video.currentTime;
                const hasChoices = frames.some(frame => Math.abs(currentTime - frame.time) < 0.2 && frame.choices && frame.choices.length > 0);
                if (!hasChoices) {
                    stopMp3();
                }
            });
        }

        // Function to show the Play button and play screen
        function showPlayButton(videoURL, frames) {
            const playButtonContainer = document.getElementById('playButtonContainer');
            const playScreen = document.getElementById('playScreen');
            const playButton = document.getElementById('playButton');
            
            // Remove any existing event listeners to prevent duplicates
            const newPlayButton = playButton.cloneNode(true);
            playButton.parentNode.replaceChild(newPlayButton, playButton);
            
            // Add click event to play the video
            newPlayButton.addEventListener('click', () => {
                setupVideoPlayer(videoURL, frames);
            });

            // Show the play screen and play button container
            playScreen.style.display = 'block';
            playButtonContainer.style.display = 'flex';
        }

        // Function to decode and process the .vne file from a ZIP
        function decodeFile() {
            const fileInput = document.getElementById('fileInput');
            const videoContainer = document.getElementById('videoContainer');
            const playButtonContainer = document.getElementById('playButtonContainer');
            const playScreen = document.getElementById('playScreen');
            const loadingScreen = document.getElementById('loadingScreen');
            const file = fileInput.files[0];

            // Hide video, play button, and play screen initially
            videoContainer.innerHTML = '';
            videoContainer.style.display = 'none';
            playButtonContainer.style.display = 'none';
            playScreen.style.display = 'none';

            if (!file) {
                alert('Please select a .vne file to decode.');
                return;
            }

            loadingScreen.style.display = 'flex';

            const reader = new FileReader();
            reader.onload = function(event) {
                const arrayBuffer = event.target.result;
                JSZip.loadAsync(arrayBuffer).then(function(zip) {
                    const vneFile = zip.file('data.vne');
                    if (!vneFile) {
                        alert('Invalid ZIP file: No data.vne found.');
                        loadingScreen.style.display = 'none';
                        return;
                    }
                    vneFile.async('string').then(function(encodedContent) {
                        try {
                            const decodedContent = simpleDecode(encodedContent);
                            const { videoURL, frames } = parseVNEContent(decodedContent);

                            if (!videoURL || frames.length === 0) {
                                alert('Invalid .vne file: Missing VideoURL or Frame data.');
                                loadingScreen.style.display = 'none';
                                return;
                            }

                            showPlayButton(videoURL, frames);
                            loadingScreen.style.display = 'none';
                        } catch (error) {
                            alert('Error decoding file: ' + error.message);
                            loadingScreen.style.display = 'none';
                        }
                    }).catch(function(error) {
                        alert('Error reading data.vne from ZIP: ' + error.message);
                        loadingScreen.style.display = 'none';
                    });
                }).catch(function(error) {
                    alert('Error reading ZIP file: ' + error.message);
                    loadingScreen.style.display = 'none';
                });
            };
            reader.onerror = function() {
                alert('Error reading file.');
                loadingScreen.style.display = 'none';
            };
            reader.readAsArrayBuffer(file);
        }

        // Function to fetch and decode .vne file from URL
        function fetchVNEFromURL(url) {
            const videoContainer = document.getElementById('videoContainer');
            const playButtonContainer = document.getElementById('playButtonContainer');
            const playScreen = document.getElementById('playScreen');
            const loadingScreen = document.getElementById('loadingScreen');

            // Hide video, play button, and play screen initially
            videoContainer.innerHTML = '';
            videoContainer.style.display = 'none';
            playButtonContainer.style.display = 'none';
            playScreen.style.display = 'none';

            loadingScreen.style.display = 'flex';

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch .vne file');
                    }
                    return response.arrayBuffer();
                })
                .then(arrayBuffer => {
                    JSZip.loadAsync(arrayBuffer).then(function(zip) {
                        const vneFile = zip.file('data.vne');
                        if (!vneFile) {
                            throw new Error('Invalid ZIP file: No data.vne found.');
                        }
                        vneFile.async('string').then(function(encodedContent) {
                            try {
                                const decodedContent = simpleDecode(encodedContent);
                                const { videoURL, frames } = parseVNEContent(decodedContent);

                                if (!videoURL || frames.length === 0) {
                                    throw new Error('Invalid .vne file: Missing VideoURL or Frame data.');
                                }

                                showPlayButton(videoURL, frames);
                                loadingScreen.style.display = 'none';
                            } catch (error) {
                                alert('Error decoding file from URL: ' + error.message);
                                loadingScreen.style.display = 'none';
                            }
                        }).catch(function(error) {
                            alert('Error reading data.vne from ZIP: ' + error.message);
                            loadingScreen.style.display = 'none';
                        });
                    }).catch(function(error) {
                        alert('Error reading ZIP file from URL: ' + error.message);
                        loadingScreen.style.display = 'none';
                    });
                })
                .catch(error => {
                    alert('Error fetching file: ' + error.message);
                    loadingScreen.style.display = 'none';
                });
        }

        // Setup drag-and-drop functionality
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const fileInput = document.getElementById('fileInput');
        const fileInputLabel = document.getElementById('fileInputLabel');
        const fileNameDisplay = document.getElementById('fileName');
        const decodeButton = document.getElementById('decodeButton');

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = `Selected: ${fileInput.files[0].name}`;
                decodeButton.disabled = false;
            } else {
                fileNameDisplay.textContent = '';
                decodeButton.disabled = true;
            }
        });

        fileUploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadContainer.classList.add('dragover');
            fileInputLabel.classList.add('dragover');
        });

        fileUploadContainer.addEventListener('dragleave', () => {
            fileUploadContainer.classList.remove('dragover');
            fileInputLabel.classList.remove('dragover');
        });

        fileUploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadContainer.classList.remove('dragover');
            fileInputLabel.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.endsWith('.vne')) {
                fileInput.files = files;
                fileNameDisplay.textContent = `Selected: ${files[0].name}`;
                decodeButton.disabled = false;
                decodeFile();
            } else {
                alert('Please drop a valid .vne file.');
            }
        });

        // Check for URL fragment and fetch .vne file if present
        window.addEventListener('load', () => {
            const hash = window.location.hash;
            if (hash && hash.startsWith('#')) {
                const vneURL = hash.substring(1);
                if (vneURL) {
                    fetchVNEFromURL(vneURL);
                }
            }
        });
    </script>
</body>
</html>